<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Git Hook Foundation: Post-Commit Event Logging</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="feature-git-hook-foundation"
             data-type="feature"
             data-status="in-progress"
             data-priority="high"
             data-created="2025-12-17T06:25:07.442881"
             data-updated="2025-12-17T06:25:12.950730">

        <header>
            <h1>Git Hook Foundation: Post-Commit Event Logging</h1>
            <div class="metadata">
                <span class="badge status-in-progress">In Progress</span>
                <span class="badge priority-high">High Priority</span>
            </div>
        </header>

        <nav data-graph-edges>
            <section data-edge-type="part-of">
                <h3>Part-Of:</h3>
                <ul>
                    <li><a href="epic-git-continuity-spine.html" data-relationship="part-of" data-since="2025-12-17T06:25:07.442886">Git as Continuity Spine: Agent-Agnostic Event Tracking</a></li>
                </ul>
            </section>
            <section data-edge-type="implemented-in">
                <h3>Implemented-In:</h3>
                <ul>
                    <li><a href="0e6fd1e4-bc71-4424-88d4-3e88562ba5ed.html" data-relationship="implemented-in" data-since="2025-12-17T06:25:12.950725">0e6fd1e4-bc71-4424-88d4-3e88562ba5ed</a></li>
                </ul>
            </section>
        </nav>
        <section data-properties>
            <h3>Properties</h3>
            <dl>
                <dt>Epic Id</dt>
                <dd data-key="epic_id" data-value="epic-git-continuity-spine">epic-git-continuity-spine</dd>
<dt>Estimated Duration</dt>
                <dd data-key="estimated_duration" data-value="3-5 days">3-5 days</dd>
            </dl>
        </section>
        <section data-steps>
            <h3>Implementation Steps</h3>
            <ol>
                <li data-completed="false">⏳ Design Git event schema for post-commit</li>
                <li data-completed="false">⏳ Create event logging utility (log_git_event)</li>
                <li data-completed="false">⏳ Implement post-commit hook script</li>
                <li data-completed="false">⏳ Create hook installer (htmlgraph init --install-hooks)</li>
                <li data-completed="false">⏳ Add hook conflict detection and chaining</li>
                <li data-completed="false">⏳ Test with real commits and verify events</li>
                <li data-completed="false">⏳ Document hook installation and behavior</li>
            </ol>
        </section>
        <section data-content>
            <h3>Description</h3>
            Implement Git post-commit hook as the foundation for agent-agnostic event tracking.

## Goals
1. Log every Git commit as an event in HtmlGraph
2. Link commits to active features automatically
3. Provide hook installer for easy setup
4. Handle existing hooks gracefully

## Event Schema Design

**GitCommit Event:**
```json
{
  "type": "GitCommit",
  "timestamp": "2025-12-17T06:00:00Z",
  "commit_hash": "abc123def",
  "commit_hash_short": "abc123d",
  "branch": "main",
  "author_name": "John Doe",
  "author_email": "john@example.com",
  "commit_message": "feat: add new feature",
  "files_changed": ["src/file.py", "tests/test.py"],
  "insertions": 45,
  "deletions": 12,
  "features": ["feature-xyz"],
  "session_id": "session-abc-123"
}
```

## Implementation Approach

### 1. Event Logging Utility
Create `src/python/htmlgraph/git_events.py`:
- `log_git_commit()` function
- Fetch git metadata
- Link to active features
- Append to events JSONL

### 2. Post-Commit Hook
Create `.htmlgraph/hooks/post-commit.sh`:
- Bash script called after git commit
- Runs `htmlgraph git-event commit`
- Async execution (<100ms)
- Error handling (never blocks commit)

### 3. Hook Installer
Add `htmlgraph init --install-hooks` command:
- Detect existing hooks
- Move to *.existing if present
- Install chained hooks
- Symlink from .git/hooks/ to .htmlgraph/hooks/

### 4. Hook Chaining
Support existing hooks:
```bash
# .git/hooks/post-commit
#!/bin/bash
# Existing hook
if [ -f .git/hooks/post-commit.existing ]; then
    .git/hooks/post-commit.existing || exit $?
fi
# HtmlGraph hook
.htmlgraph/hooks/post-commit.sh || true  # Never fail
```

## Testing Strategy
1. Create test commits
2. Verify events logged
3. Check feature attribution
4. Test hook chaining
5. Test conflict scenarios

## Success Criteria
- [x] Post-commit events logged automatically
- [x] Events link to active features
- [x] Hook installer works
- [x] Existing hooks preserved
- [x] <100ms overhead per commit
- [x] Documentation complete
        </section>
    </article>
</body>
</html>
