<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Planning Workflow Optimization: Reduce Tool Calls & Improve Research</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="spk-cc60da1b"
             data-type="spike"
             data-status="done"
             data-priority="medium"
             data-created="2025-12-25T03:24:20.155412"
             data-updated="2025-12-25T03:24:20.155416" data-track-id="trk-42a6bc49">

        <header>
            <h1>Planning Workflow Optimization: Reduce Tool Calls & Improve Research</h1>
            <div class="metadata">
                <span class="badge status-done">Done</span>
                <span class="badge priority-medium">Medium Priority</span>
            </div>
        </header>

        <section data-steps>
            <h3>Implementation Steps</h3>
            <ol>
                <li data-completed="true">‚úÖ Analyze current planning workflow inefficiencies</li>
                <li data-completed="true">‚úÖ Research best practices for session/transition management (web search)</li>
                <li data-completed="true">‚úÖ Document optimal planning workflow with subagent delegation</li>
                <li data-completed="true">‚úÖ Improve /htmlgraph:plan command to reduce exploratory API calls</li>
                <li data-completed="true">‚úÖ Add SDK API documentation to slash command context</li>
                <li data-completed="true">‚úÖ Create planning workflow template with research phase</li>
            </ol>
        </section>
        <section data-content>
            <h3>Description</h3>
            # Planning Workflow Optimization

## Problem Statement

Current planning workflow used **21 tool calls** with **3 errors** for a simple planning task.

## Specific Issues Identified (from /htmlgraph:plan execution)

### 1. Trial-and-Error SDK Usage (3 errors)
- ‚ùå `AttributeError: 'Track' object has no attribute 'spec'` (line 67)
- ‚ùå `ValueError: "Node" object has no field "findings"` (line 99)  
- ‚ùå `Invalid CLI choice 'spike'` (used wrong command)

**Root cause**: Exploratory API calls without knowing SDK structure

### 2. No Web Research
- ‚ùå Invented auto-spike solution without researching existing patterns
- ‚ùå No search for session management best practices
- ‚ùå Could have found proven approaches (e.g., workflow engines, state machines)

**Root cause**: Jumped to implementation without research phase

### 3. No Subagent Delegation
- ‚ùå Sequential processing (research ‚Üí design ‚Üí plan)
- ‚ùå Should have used Task agent for parallel research
- ‚ùå Could have delegated web search to specialist agent

**Root cause**: Did all work synchronously instead of leveraging parallelism

### 4. Slash Command Underutilized
- ‚ùå `/htmlgraph:plan` should provide SDK structure upfront
- ‚ùå Should include examples of TrackBuilder API
- ‚ùå Could eliminate 5+ exploratory Read/Grep calls

**Root cause**: Command doesn't provide enough context

## Expected Workflow (Optimal)

```
User: /htmlgraph:plan "session management with auto-spikes"
  ‚Üì
1. Slash command provides SDK context (TrackBuilder API, examples)
  ‚Üì
2. Launch research subagent (web search + analysis)
  ‚Üì  
3. Subagent returns: Best practices, proven patterns, recommendations
  ‚Üì
4. Create track with TrackBuilder (1 call, no errors)
  ‚Üì
5. Create features (1 call, batch operation)
  ‚Üì
DONE: ~5-7 tool calls total, 0 errors
```

## Proposed Improvements

### A. Enhance /htmlgraph:plan Command
- Include TrackBuilder API reference in context
- Provide working examples
- Show Node/Track/Spec/Plan schema
- Reduce exploratory reads by 80%

### B. Add Mandatory Research Phase
- Always launch Task agent for web research
- Search for: "session management best practices", "workflow state machines", etc.
- Return proven patterns before designing solution
- 5-10 minutes of research saves hours of wrong implementation

### C. Improve Subagent Usage
- Use Task tool for research (parallel)
- Delegate complex planning to Plan agent
- Batch API operations (create 5 features in 1 call)

### D. SDK Error Prevention
- Add type hints/docstrings visible to LLM
- Provide schema validation before API calls
- Return helpful error messages with examples

## Success Metrics

- **Tool call reduction**: 21 ‚Üí 7 calls (67% reduction)
- **Error rate**: 14% ‚Üí 0%
- **Research quality**: 0 web searches ‚Üí 3-5 targeted searches
- **Time to plan**: Same or faster (parallel research)

## Research Findings (via Subagent + Web Search)

### ‚úÖ HtmlGraph Approach is Sound
Current session management aligns with industry patterns:
- Event-sourced architecture (Git-friendly) ‚úÖ
- Smart attribution with weighted heuristics ‚úÖ  
- Drift detection across 4 signals ‚úÖ
- Agent-specific session lookup ‚úÖ

### üéØ Key Discovery: Industry Gap
Traditional systems handle transitions poorly:
- ‚ùå Ignore transitions (activities lost)
- ‚ùå Attribute to nearest feature (noise)
- ‚ùå Mark as drift (false positives)

**Our auto-spike solution fills this gap!**

### Industry Patterns Validated

**1. Two-Layer Memory** (AWS Bedrock, LangGraph)
- Working memory (session-specific) ‚úÖ
- Persistent memory (cross-session) ‚úÖ
HtmlGraph already implements this correctly.

**2. State Transition Patterns**
- Sequential, Parallel, Router, Loop
- HTML edges naturally represent these ‚úÖ

**3. Session Lifecycle** (15min idle threshold is standard)
```
CREATION ‚Üí ACTIVE ‚Üí IDLE ‚Üí TERMINATED
```
Our `active ‚Üí stale ‚Üí ended` aligns perfectly.

**4. Attribution Algorithms** (Validated!)
- Explicit assignment (highest confidence)
- Heuristic scoring (our 40/30/20/10 weights) ‚úÖ
- File patterns, keywords, type priority ‚úÖ

**5. System Overhead Classification**
- Meta-operations, infrastructure reads
- Child activities, development tools
- HtmlGraph already handles this! ‚úÖ

### Recommended Enhancements (Research-Backed)

**Immediate Impact:**
1. Auto-generate transition spikes (addresses industry gap)
2. Add explicit idle state detection (15min threshold)
3. State validation for consistency

**Future Enhancements:**
4. OpenTelemetry export (standard observability)
5. Machine learning attribution (emerging practice)

### Sources
- Anthropic Engineering: Long-running agents
- Google Developers: Multi-agent frameworks  
- Microsoft Azure: AI Agent patterns
- LangChain: Memory & state persistence
- AWS Bedrock: Session management APIs
- OpenTelemetry: LLM observability
        </section>
    </article>
</body>
</html>
