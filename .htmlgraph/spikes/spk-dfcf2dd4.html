<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Session Management with Auto-Generated Transition Spikes</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="spk-dfcf2dd4"
             data-type="spike"
             data-status="done"
             data-priority="medium"
             data-created="2025-12-25T03:12:33.601559"
             data-updated="2025-12-25T03:12:33.601562" data-track-id="trk-20d8c147">

        <header>
            <h1>Session Management with Auto-Generated Transition Spikes</h1>
            <div class="metadata">
                <span class="badge status-done">Done</span>
                <span class="badge priority-medium">Medium Priority</span>
            </div>
        </header>

        <section data-steps>
            <h3>Implementation Steps</h3>
            <ol>
                <li data-completed="true">✅ Research current session lifecycle and event tracking</li>
                <li data-completed="true">✅ Design auto-spike generation mechanism for session transitions</li>
                <li data-completed="true">✅ Define spike metadata (model info, timestamps, session context)</li>
                <li data-completed="true">✅ Plan feature activation/deactivation workflow</li>
                <li data-completed="true">✅ Design transition spike creation (feature complete → spike)</li>
                <li data-completed="true">✅ Document activity attribution rules (feature vs transition)</li>
                <li data-completed="true">✅ Create implementation plan with effort estimates</li>
            </ol>
        </section>
        <section data-content>
            <h3>Description</h3>
            # Session Management with Auto-Generated Transition Spikes

## Problem Statement
Currently, transitional activities (session start, feature switching, post-completion) get:
- Attributed to previous feature (incorrect)
- Marked as drift (misleading)  
- Lost in session noise (poor visibility)

**Need**: Clear attribution boundaries for ALL activities, not just feature work.

## Current Session Lifecycle

**Start** → SessionManager.start_session()
- Creates Session with auto-ID, agent, status="active"
- Tracks: start_commit, started_at, agent

**Activity** → SessionManager.track_activity()
- Logs tool calls with auto-attribution
- Scoring: file patterns (40%), keywords (30%), type (20%), primary (10%)
- Drift detection when activity doesn't match active features

**End** → SessionManager.end_session()
- Status → "ended", saves handoff_notes, blockers

### Gap: Transitional Activities
- ❌ Session startup (before picking work)
- ❌ Between features (context switching, planning)
- ❌ Post-completion (cleanup, review, testing)

## Proposed Solution

### Auto-Generated Transition Spikes

**Lifecycle Flow:**
```
Session Start
    ↓
[Auto-Spike: session-init-{session_id}]  ← Catches startup activities
    ↓
Feature Start  ← Auto-completes session-init spike
    ↓
[Feature: feat-123 - ACTIVE]  ← Feature work
    ↓
Feature Complete
    ↓
[Auto-Spike: transition-{timestamp}]  ← Catches post-feature activities
    ↓
Next Feature Start  ← Auto-completes transition spike
    ↓
... repeat ...
    ↓
Session End  ← Auto-completes final transition spike
```

### Spike Types

**1. Session Initialization Spike**
- **ID Format**: `spike-init-{session_id_short}`
- **Created**: Session start (before any feature)
- **Purpose**: Catch review, planning, setup activities
- **Metadata**: model_name, session_id, started_at
- **Completes**: When first feature starts

**2. Transition Spike**
- **ID Format**: `spike-trans-{timestamp}`
- **Created**: When feature completes
- **Purpose**: Catch cleanup, review, planning between features
- **Metadata**: from_feature_id, session_id, transition_at
- **Completes**: When next feature starts OR session ends

### Implementation Requirements

**1. New Spike Fields** (extend Node model)
```python
spike_subtype: Literal["session-init", "transition", "planning", "investigation"] | None
auto_generated: bool = False  # True for session-init/transition
session_id: str | None = None
from_feature_id: str | None = None  # For transition spikes
to_feature_id: str | None = None    # Filled when next feature starts
model_name: str | None = None       # e.g., "claude-sonnet-4-5"
```

**2. SessionManager Changes**
- `start_session()`: Auto-create session-init spike
- `complete_feature()`: Auto-create transition spike
- `start_feature()`: Auto-complete previous spike, set to_feature_id

**3. Attribution Logic Updates**
- Active spike takes precedence over features
- Session-init spike: Lowest priority (fallback)
- Transition spike: Medium priority (between features)
- Feature: Highest priority (when active)

**4. Dashboard/CLI Updates**
- Show auto-generated spikes in session timeline
- Filter auto-spikes from regular spike lists
- Analytics: "Time in transitions" metric

## Benefits

✅ **Complete Attribution**: Every activity has a clear owner (feature or spike)
✅ **Transition Visibility**: See time spent context-switching, planning
✅ **Better Drift Detection**: Drift only within active feature/spike boundaries
✅ **Session Continuity**: Init spike shows what happened before first feature
✅ **Analytics Insights**: Measure transition overhead, planning time

## Implementation Plan

See implementation steps in spike checklist.
        </section>
    </article>
</body>
</html>
