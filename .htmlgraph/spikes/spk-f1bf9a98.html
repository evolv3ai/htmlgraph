<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="htmlgraph-version" content="1.0">
    <title>Dependency Optimization Analysis (ALL Dependencies)</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <article id="spk-f1bf9a98"
             data-type="spike"
             data-status="done"
             data-priority="medium"
             data-created="2026-01-02T18:29:45.641568"
             data-updated="2026-01-02T18:29:45.641572" data-spike-type="general">

        <header>
            <h1>Dependency Optimization Analysis (ALL Dependencies)</h1>
            <div class="metadata">
                <span class="badge status-done">Done</span>
                <span class="badge priority-medium">Medium Priority</span>
            </div>
        </header>

    
        <section data-spike-metadata>
            <h3>Spike Metadata</h3>
            <dl>
                <dt>Type</dt>
                <dd>General</dd>
            </dl>
        </section>
        <section data-findings>
            <h3>Findings</h3>
            <div class="findings-content">
                
# Executive Summary
HtmlGraph currently utilizes a solid foundation of dependencies (Rich, Pydantic, Watchdog), but significantly underutilizes their advanced capabilities. By shifting philosophy from "HTML-only constraints" to "HTML-as-Storage, Python-as-Engine", we can unlock massive value for AI agents. The most critical missing piece is proper graph analysis (NetworkX) and structural visualization (Rich Tree).

# Current Dependency Analysis

## rich
**Current Usage:** Basic Console, Progress, Table, Panel.
**Optimization Opportunities:**
- **Tree**: CRITICAL for agents/humans to visualize graph hierarchy (Track -> Feature -> Task).
- **Markdown**: Render descriptions/specs natively in CLI.
- **Syntax**: Highlight code blocks in chat/logs.
- **Inspect**: Debug object state for agents.
- **Traceback**: Better error reporting.

## pydantic
**Current Usage:** Basic BaseModel, Field, simple validators.
**Optimization Opportunities:**
- **computed_field**: Move logic (e.g., 'is_blocked', 'completion_status') into the model.
- **model_serializer**: Create specific JSON dumps optimized for LLM context window (compact).
- **validate_call**: Enforce type safety on SDK methods automatically.
- **JSON Schema**: Export schemas for agent discovery.

## watchdog
**Current Usage:** Custom event handler implementation.
**Optimization Opportunities:**
- **PatternMatchingEventHandler**: Simplify the custom regex/glob logic using built-in classes.
- **Recursive Watching**: Currently manual for some collections; could be streamlined.

## jinja2
**Current Usage:** Basic template loading.
**Optimization Opportunities:**
- **Macros**: Create reusable 'components' (badges, status pills) for generated reports.
- **StrictUndefined**: Prevent silent failures in template rendering.

## justhtml
**Current Usage:** Core parsing/generation.
**Optimization Opportunities:**
- **Validation**: Ensure generated HTML meets strict schema requirements before saving.
- **Fragments**: Better support for updating partial HTML (just the body/status).

# High-Impact Recommendations (Prioritized)

## 1. Rich Tree Visualization
**Package:** rich
**Feature:** Tree
**Benefit:** Allows agents and users to see the *structure* of work, not just lists.
**Audience:** Agents (context) + Users (understanding)
**Effort:** Low
**Code Example:**
```python
from rich.tree import Tree
tree = Tree('Track: Auth System')
feat = tree.add('Feature: Login')
feat.add('Task: UI')
feat.add('Task: API')
print(tree)
```

## 2. Pydantic Computed Fields
**Package:** pydantic
**Feature:** @computed_field
**Benefit:** Guarantees state consistency. 'is_blocked' is never stale.
**Audience:** Agents (reliable state)
**Effort:** Low
**Code Example:**
```python
@computed_field
@property
def is_blocked(self) -> bool:
    return any(d.status != 'done' for d in self.dependencies)
```

## 3. NetworkX Integration
**Package:** networkx (NEW)
**Benefit:** Real graph algorithms. Detect cycles, find critical paths, topological sort.
**Audience:** Agents (planning)
**Effort:** Medium

# New Dependencies to Consider

## NetworkX
**Purpose:** Comprehensive graph algorithms.
**Transformative Benefit:** Enables 'smart' planning. Agents can ask "What is the critical path?" or "Are there circular dependencies?" without implementing complex recursion.
**Size:** ~3MB
**Maintenance:** Industry standard, highly active.
**Recommendation:** **ADD (HIGH PRIORITY)**

## orjson
**Purpose:** Ultra-fast JSON serialization.
**Transformative Benefit:** Speed up large graph dumps/loads for agents.
**Size:** Binary (small)
**Recommendation:** **ADD (MEDIUM PRIORITY)**

## Textual
**Purpose:** TUI framework (built on Rich).
**Transformative Benefit:** Turn the CLI into an interactive application.
**Recommendation:** **CONSIDER (FUTURE)** - Focus on SDK/CLI first.

# Removal Candidates
None. All current dependencies are essential. The focus should be on *deepening* usage, not removal.

# Implementation Roadmap

**Phase 1: Quick Wins (1-2 days)**
- [x] Analyze dependencies (Done)
- [ ] Implement Rich Tree for 'htmlgraph status'
- [ ] Refactor Pydantic models to use @computed_field for status logic

**Phase 2: Graph Intelligence (3-5 days)**
- [ ] Add 'networkx' dependency
- [ ] Create GraphManager to build in-memory networkx graph from HTML files
- [ ] Expose 'find_cycles()' and 'critical_path()' to agents

**Phase 3: Agent Experience (1-2 weeks)**
- [ ] Implement custom 'model_serializer' for token-efficient LLM context
- [ ] Add rich markdown rendering for 'htmlgraph show'

            </div>
        </section>
        <section data-decision>
            <h3>Decision</h3>
            <p>
**Priority Order:**
1. **Rich Tree**: Immediate visibility win.
2. **NetworkX**: Critical for "Graph" part of HtmlGraph.
3. **Pydantic Computed Fields**: Logic consistency.

**New Dependencies:**
- Add: **networkx** (Standard for graph algos)
- Add: **orjson** (Performance)

**Next Steps:**
1. Update `pyproject.toml` to include `networkx`.
2. Create a prototype of Rich Tree visualization.
</p>
        </section>
    </article>
</body>
</html>
