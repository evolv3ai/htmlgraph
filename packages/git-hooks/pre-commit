#!/bin/bash
# HtmlGraph Pre-Commit Hook
# Blocks direct edits to .htmlgraph/ files
# Install via: htmlgraph init --hooks or cp to .git/hooks/pre-commit

# ANSI colors
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Get list of staged .htmlgraph/ files
HTMLGRAPH_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "^\.htmlgraph/" || true)

if [ -n "$HTMLGRAPH_FILES" ]; then
    echo -e "${RED}ERROR: Direct edits to .htmlgraph/ files are blocked${NC}"
    echo ""
    echo "The following files were modified directly:"
    echo "$HTMLGRAPH_FILES" | while read -r file; do
        echo "  - $file"
    done
    echo ""
    echo -e "${YELLOW}Use SDK instead:${NC}"
    echo "  from htmlgraph import SDK"
    echo "  sdk = SDK()"
    echo "  sdk.features.complete('feature-id')  # Mark feature done"
    echo "  sdk.features.create('Title')         # Create new feature"
    echo ""
    echo "Or CLI:"
    echo "  uv run htmlgraph feature complete <id>"
    echo "  uv run htmlgraph feature create 'Title'"
    echo ""
    echo "To bypass (NOT RECOMMENDED):"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

exit 0
